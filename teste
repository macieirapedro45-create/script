local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer
local PlayerGui = player:WaitForChild("PlayerGui")

-- Base (posição salva ao apertar P)
local basePosition = nil

-- Detectar apertar da tecla P para definir a base
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if not gameProcessed and input.UserInputType == Enum.UserInputType.Keyboard and input.KeyCode == Enum.KeyCode.P then
        local char = player.Character
        if char and char:FindFirstChild("HumanoidRootPart") then
            basePosition = char.HumanoidRootPart.Position
        end
    end
end)

-- Variáveis de voo
local flying = false
local flyingToBase = false
local fly10s = false
local flyConnection
local verticalDirection = 0 -- 1 para subir, -1 para descer, 0 para manter

-- Detecta E (subir) e Q (descer) para fly inf e fly 10s
UserInputService.InputBegan:Connect(function(input, gp)
    if (flying or fly10s) and not gp and input.UserInputType == Enum.UserInputType.Keyboard then
        if input.KeyCode == Enum.KeyCode.E then
            verticalDirection = 1
        elseif input.KeyCode == Enum.KeyCode.Q then
            verticalDirection = -1
        end
    end
end)
UserInputService.InputEnded:Connect(function(input, gp)
    if (flying or fly10s) and not gp and input.UserInputType == Enum.UserInputType.Keyboard then
        if input.KeyCode == Enum.KeyCode.E or input.KeyCode == Enum.KeyCode.Q then
            verticalDirection = 0
        end
    end
end)

local function getHighestPlayerY()
    local highest = -math.huge
    for _,plr in ipairs(Players:GetPlayers()) do
        if plr ~= player and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
            local y = plr.Character.HumanoidRootPart.Position.Y
            if y > highest then
                highest = y
            end
        end
    end
    return highest
end

local function stopAllFlying()
    flying = false
    flyingToBase = false
    fly10s = false
    local char = player.Character
    if char then
        local hrp = char:FindFirstChild("HumanoidRootPart")
        if hrp and hrp:FindFirstChild("FlyInf") then
            hrp.FlyInf:Destroy()
        end
        if hrp and hrp:FindFirstChild("Fly10s") then
            hrp.Fly10s:Destroy()
        end
        local hum = char:FindFirstChildOfClass("Humanoid")
        if hum then
            hum.PlatformStand = false
        end
    end
    if flyConnection then flyConnection:Disconnect() end
    verticalDirection = 0
end

local function startFlyingAbovePlayers()
    stopAllFlying()
    flying = true

    local char = player.Character
    if not char then return end
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    if hrp:FindFirstChild("FlyInf") then
        hrp.FlyInf:Destroy()
    end

    flyConnection = RunService.RenderStepped:Connect(function()
        if not flying or not char or not char.Parent then
            if flyConnection then flyConnection:Disconnect() end
            return
        end

        -- Mantém acima dos outros jogadores
        local highestY = getHighestPlayerY()
        local targetY = highestY + 3
        if highestY == -math.huge then
            targetY = hrp.Position.Y
        end

        local currentPosition = hrp.Position
        local desiredY = currentPosition.Y

        -- Se apertou E ou Q, sobe/desce
        if verticalDirection ~= 0 then
            desiredY = currentPosition.Y + verticalDirection * 0.5
        else
            -- Mantém acima dos jogadores, mas não desce se já está acima
            if currentPosition.Y < targetY then
                desiredY = currentPosition.Y + 0.3
            elseif currentPosition.Y > targetY + 1 then
                desiredY = currentPosition.Y - 0.3
            end
        end

        local velocity = Vector3.new(0, math.clamp((desiredY - currentPosition.Y) * 15, -15, 15), 0)
        if not hrp:FindFirstChild("FlyInf") then
            local bv = Instance.new("BodyVelocity")
            bv.Name = "FlyInf"
            bv.Parent = hrp
            bv.MaxForce = Vector3.new(0,1,0) * 1e5 -- Só força vertical!
        end
        hrp.FlyInf.Velocity = velocity
    end)

    char.AncestryChanged:Connect(stopAllFlying)
end

local function startFlyingToBase()
    stopAllFlying()
    if not basePosition then return end
    flyingToBase = true

    local char = player.Character
    if not char then return end
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end
    local hum = char:FindFirstChildOfClass("Humanoid")
    if not hum then return end

    hum.PlatformStand = true -- Voo automático, sem controle manual

    if hrp:FindFirstChild("FlyToBase") then
        hrp.FlyToBase:Destroy()
    end

    flyConnection = RunService.RenderStepped:Connect(function()
        if not flyingToBase or not char or not char.Parent then
            hum.PlatformStand = false
            if flyConnection then flyConnection:Disconnect() end
            return
        end

        local highestY = getHighestPlayerY()
        local minHeight = highestY + 3
        if highestY == -math.huge then
            minHeight = hrp.Position.Y
        end

        local currentPosition = hrp.Position
        local targetPos = Vector3.new(basePosition.X, math.max(basePosition.Y, minHeight), basePosition.Z)
        local direction = (targetPos - currentPosition)
        local dist = direction.Magnitude
        -- Parar quando chegar próximo
        if dist < 1 then
            stopAllFlying()
            return
        end

        local velocity = direction.Unit * math.min(dist, 15)
        if math.abs(velocity.Y) > 15 then
            velocity = Vector3.new(velocity.X, math.clamp(velocity.Y, -15, 15), velocity.Z)
        end
        if not hrp:FindFirstChild("FlyToBase") then
            local bv = Instance.new("BodyVelocity")
            bv.Name = "FlyToBase"
            bv.Parent = hrp
            bv.MaxForce = Vector3.new(1,1,1) * 1e5
        end
        hrp.FlyToBase.Velocity = velocity
    end)

    char.AncestryChanged:Connect(stopAllFlying)
end

local function startFly10s()
    stopAllFlying()
    fly10s = true

    local char = player.Character
    if not char then return end
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    if hrp:FindFirstChild("Fly10s") then
        hrp.Fly10s:Destroy()
    end

    local startTime = tick()
    flyConnection = RunService.RenderStepped:Connect(function()
        if not fly10s or not char or not char.Parent then
            if flyConnection then flyConnection:Disconnect() end
            return
        end
        -- Permite controlar com E/Q
        local vertical = 40 -- Default velocidade para cima
        if verticalDirection == 1 then
            vertical = 15
        elseif verticalDirection == -1 then
            vertical = -15
        end
        if not hrp:FindFirstChild("Fly10s") then
            local bv = Instance.new("BodyVelocity")
            bv.Name = "Fly10s"
            bv.Parent = hrp
            bv.MaxForce = Vector3.new(0,1,0) * 1e5 -- Só força vertical!
        end
        hrp.Fly10s.Velocity = Vector3.new(0, vertical, 0)
        if tick() - startTime > 10 then
            stopAllFlying()
        end
    end)

    char.AncestryChanged:Connect(stopAllFlying)
end

-- Criar ScreenGui
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "PedroHub"
screenGui.Parent = PlayerGui
screenGui.ResetOnSpawn = false -- mantém a UI mesmo após a morte do personagem

-- Janela principal (maior e arrastável)
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 600, 0, 370)
mainFrame.Position = UDim2.new(0.5, -300, 0.5, -185)
mainFrame.BackgroundColor3 = Color3.fromRGB(255,255,255)
mainFrame.Active = true -- Permite arrastar
mainFrame.Draggable = true -- Permite arrastar
mainFrame.Parent = screenGui

-- Lateral azul
local sideBar = Instance.new("Frame")
sideBar.Size = UDim2.new(0, 110, 1, 0)
sideBar.Position = UDim2.new(0, 0, 0, 0)
sideBar.BackgroundColor3 = Color3.fromRGB(18, 47, 255)
sideBar.Parent = mainFrame

local function createTabButton(name, yPos)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1, -20, 0, 48)
    btn.Position = UDim2.new(0, 10, 0, yPos)
    btn.BackgroundColor3 = Color3.fromRGB(255,255,255)
    btn.Font = Enum.Font.SourceSansBold
    btn.TextSize = 25
    btn.TextColor3 = Color3.fromRGB(0,0,0)
    btn.Text = name
    btn.Parent = sideBar
    return btn
end

local hubBtn = createTabButton("pedro hub", 24)
local creditsBtn = createTabButton("credits", 85)
local stealerBtn = createTabButton("stealer", 146)

local contentFrame = Instance.new("Frame")
contentFrame.Size = UDim2.new(1, -130, 1, -20)
contentFrame.Position = UDim2.new(0, 120, 0, 10)
contentFrame.BackgroundColor3 = Color3.fromRGB(255,255,255)
contentFrame.Parent = mainFrame

local function clearContent()
    for _,v in pairs(contentFrame:GetChildren()) do
        v:Destroy()
    end
end

local function showCredits()
    clearContent()
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, 0, 0, 60)
    label.Position = UDim2.new(0,0,0,0)
    label.BackgroundTransparency = 1
    label.Font = Enum.Font.SourceSansBold
    label.TextSize = 32
    label.TextColor3 = Color3.fromRGB(0,0,0)
    label.Text = "Créditos: pedrao preao + roblox"
    label.Parent = contentFrame
end

local function showStealer()
    clearContent()
    -- Caixa azul claro, igual da imagem
    local box = Instance.new("Frame")
    box.Size = UDim2.new(0.95, 0, 0.8, 0)
    box.Position = UDim2.new(0.025, 0, 0.08, 0)
    box.BackgroundColor3 = Color3.fromRGB(80,170,255)
    box.BorderSizePixel = 0
    box.Parent = contentFrame

    -- Guardar referência para os botões para atualizar cor
    local buttonRefs = {}

    local function setButtonColor(btn, enabled, flash)
        if not enabled then
            btn.BackgroundColor3 = Color3.fromRGB(160, 160, 160)
        else
            btn.BackgroundColor3 = Color3.fromRGB(255,0,0)
            if flash then
                btn.BackgroundColor3 = Color3.fromRGB(0,200,0)
                task.wait(0.5)
                btn.BackgroundColor3 = Color3.fromRGB(255,0,0)
            end
        end
    end

    local options = {
        {
            label="fly to base",
            func=function(btn)
                if basePosition then
                    setButtonColor(btn, true, true)
                    startFlyingToBase()
                end
            end,
            isEnabled=function() return basePosition ~= nil end
        },
        {
            label="fly 10 s",
            func=function(btn)
                setButtonColor(btn, true, true)
                startFly10s()
            end,
            isEnabled=function() return true end
        },
        {
            label="fly inf",
            func=function(btn)
                setButtonColor(btn, true, true)
                startFlyingAbovePlayers()
            end,
            isEnabled=function() return true end
        }
    }

    for i, opt in ipairs(options) do
        local row = Instance.new("Frame")
        row.Size = UDim2.new(0.9, 0, 0, 54)
        row.Position = UDim2.new(0.05, 0, 0, 16 + (i-1)*64)
        row.BackgroundTransparency = 1
        row.Parent = box

        local txt = Instance.new("TextLabel")
        txt.Size = UDim2.new(0.62, 0, 1, 0)
        txt.Position = UDim2.new(0, 0, 0, 0)
        txt.BackgroundTransparency = 1
        txt.Font = Enum.Font.SourceSans
        txt.TextSize = 25
        txt.TextColor3 = Color3.fromRGB(0,0,0)
        txt.Text = opt.label
        txt.TextXAlignment = Enum.TextXAlignment.Left
        txt.Parent = row

        local btn = Instance.new("TextButton")
        btn.Size = UDim2.new(0.32, 0, 0.75, 0)
        btn.Position = UDim2.new(0.65, 0, 0.12, 0)
        btn.Font = Enum.Font.SourceSansBold
        btn.Text = ""
        btn.AutoButtonColor = true
        btn.Parent = row
        buttonRefs[i] = btn

        local function refreshBtn()
            btn.AutoButtonColor = opt.isEnabled()
            setButtonColor(btn, opt.isEnabled(), false)
        end

        btn.MouseButton1Click:Connect(function()
            if opt.isEnabled() then
                opt.func(btn)
            end
        end)

        -- Atualiza a cor inicial
        refreshBtn()
        -- Atualiza sempre que o mouse entra
        btn.MouseEnter:Connect(refreshBtn)
    end

    -- Atualizador de botões (ex: quando a base é registrada)
    local function refreshAllButtons()
        for i,opt in ipairs(options) do
            local btn = buttonRefs[i]
            if btn then
                btn.AutoButtonColor = opt.isEnabled()
                setButtonColor(btn, opt.isEnabled(), false)
            end
        end
    end

    -- Atualiza quando basePosition muda (checa a cada 0.5s)
    task.spawn(function()
        local lastBase = basePosition
        while box.Parent do
            if basePosition ~= lastBase then
                refreshAllButtons()
                lastBase = basePosition
            end
            task.wait(0.5)
        end
    end)

    -- Botão para parar voo inf/voo 10s/voo para base
    local stopBtn = Instance.new("TextButton")
    stopBtn.Size = UDim2.new(0.32, 0, 0, 34)
    stopBtn.Position = UDim2.new(0.65, 0, 0.81, 0)
    stopBtn.BackgroundColor3 = Color3.fromRGB(255,80,80)
    stopBtn.Font = Enum.Font.SourceSansBold
    stopBtn.Text = "Parar voo"
    stopBtn.TextColor3 = Color3.fromRGB(255,255,255)
    stopBtn.Parent = box
    stopBtn.MouseButton1Click:Connect(stopAllFlying)
end

local function showHub()
    clearContent()
end

hubBtn.MouseButton1Click:Connect(showHub)
creditsBtn.MouseButton1Click:Connect(showCredits)
stealerBtn.MouseButton1Click:Connect(showStealer)

local closeBtn = Instance.new("TextButton")
closeBtn.Size = UDim2.new(0, 54, 0, 54)
closeBtn.Position = UDim2.new(1, -58, 0, 8)
closeBtn.BackgroundTransparency = 1
closeBtn.Text = "X"
closeBtn.Font = Enum.Font.SourceSansBold
closeBtn.TextSize = 54
closeBtn.TextColor3 = Color3.fromRGB(255,0,0)
closeBtn.Parent = mainFrame
closeBtn.MouseButton1Click:Connect(function()
    screenGui:Destroy()
end)

showHub()
